import{useRef as e,forwardRef as t,useState as r,useMemo as n,useImperativeHandle as o,useEffect as a,useCallback as l}from"react";import{Form as i,Modal as s,Table as c,Row as u,Col as d,Space as p,Tooltip as m,Button as f}from"antd";import{isEmpty as y,pick as g,identity as h,isNil as v}from"lodash-es";import{jsx as O,jsxs as x}from"react/jsx-runtime";import{SearchOutlined as F,ReloadOutlined as b}from"@ant-design/icons";var w=Object.defineProperty,k=Object.defineProperties,C=Object.getOwnPropertyDescriptors,T=Object.getOwnPropertySymbols,j=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable,S=(e,t,r)=>t in e?w(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,z=(e,t)=>{for(var r in t||(t={}))j.call(t,r)&&S(e,r,t[r]);if(T)for(var r of T(t))P.call(t,r)&&S(e,r,t[r]);return e},V=(e,t)=>k(e,C(t)),E=(e,t)=>{var r={};for(var n in e)j.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&T)for(var n of T(e))t.indexOf(n)<0&&P.call(e,n)&&(r[n]=e[n]);return r};var L=function(e){const[t,n]=r(!!e),o=l((()=>n(!0)),[]),a=l((()=>n(!1)),[]),i=l((()=>n((e=>!e))),[]);return{state:t,setValue:n,setTrue:o,setFalse:a,toggle:i}},K=(e=>(e.View="view",e.Copy="copy",e.Add="add",e.Edit="edit",e))(K||{}),B=()=>e(null),N=e=>{const a=null!=e?e:{},{cancelText:l,okText:c,onError:u,onOk:d,onCancel:p,destroyOnClose:m=!0,submit:f}=a,g=E(a,["cancelText","okText","onError","onOk","onCancel","destroyOnClose","submit"]);return e=>{const a=t(((t,a)=>{const[v,x]=r(),[F,b]=r("view"),[w,k]=r(),[C,T]=r({}),j=L(),P=L(),[S]=i.useForm(),E=n((()=>"view"===F),[F]);return o(a,(()=>({open:e=>{const{title:t,initialValue:r,mode:n,record:o={}}=e;y(r)||(k(r),S.setFieldsValue(r)),T(o),n&&b(n),x(t),P.setTrue()}}))),O(s,V(z({title:v,open:P.state,okText:c,onCancel:e=>{null==p||p(e),P.setFalse()},okButtonProps:{style:{display:E?"none":"inline-block"}},cancelButtonProps:{type:E?"primary":"default"},onOk:e=>{return t=void 0,r=null,n=function*(){j.setTrue();const{errorFields:t}=yield S.validateFields().catch(h);t?j.setFalse():null==f||f({mode:F,data:S.getFieldsValue(),record:C}).then((()=>{j.setFalse(),null==d||d(e)})).catch((()=>{null==u||u()}))},new Promise(((e,o)=>{var a=e=>{try{i(n.next(e))}catch(e){o(e)}},l=e=>{try{i(n.throw(e))}catch(e){o(e)}},i=t=>t.done?e(t.value):Promise.resolve(t.value).then(a,l);i((n=n.apply(t,r)).next())}));var t,r,n},destroyOnClose:m,confirmLoading:j.state,cancelText:l},g),{children:O(e,{form:S,mode:F,data:null!=w?w:{}})}))}));var v;return a.displayName=`withModal(${v=e,v.displayName||v.name||"Component"})`,a}},A=e=>{const{search:t,reset:r,FormComponent:n,resetLoading:o,searchLoading:a}=e;return L(),x(u,{justify:"space-between",gutter:8,wrap:!1,children:[O(d,{flex:1,children:n}),O(d,{flex:0,children:x(p,{align:"start",children:[O(m,{title:"查询",children:O(f,{loading:a,type:"primary",icon:O(F,{}),onClick:()=>{t()}})}),O(p,{direction:"vertical",children:O(m,{title:"重置",children:O(f,{loading:o,icon:O(b,{}),onClick:()=>{r()}})})})]})})]})},D=()=>e(null),I=e=>{const{pageSize:n=10,service:l,FormComponent:s}=e,u={current:1,pageSize:n,total:n},d=L(),p=L(),m=L(),[f]=i.useForm(),[y,h]=r(),[F,b]=r({}),[w,k]=r(u),[C,T]=r(),[j,P]=r(),S=e=>{const{current:t=u.current,pageSize:r=u.pageSize,filters:n,sorter:o,extra:a={}}=null!=e?e:{};l({current:t,pageSize:r,filters:n,sorter:o,extra:a}).then((({total:e,list:t})=>{h(t),k((t=>V(z({},t),{total:e}))),d.setFalse(),m.setFalse(),p.setFalse()}))};a((()=>{d.setTrue(),S(V(z({},w),{filters:C,sorter:j,extra:F}))}),[F,w.current,w.pageSize,j,C]);return t(((e,t)=>{const r=e,{rowKey:n="id",sticky:a=!0}=r,l=E(r,["rowKey","sticky"]);return o(t,(()=>({refresh(){d.setTrue(),S(V(z({},w),{current:1,filters:C,sorter:j,extra:F}))}}))),x("div",{children:[s&&O(A,{FormComponent:O(s,{form:f}),searchLoading:m.state,resetLoading:p.state,reset:()=>{p.setTrue(),k((e=>V(z({},e),{current:1}))),f.resetFields(),b({})},search:()=>{var e;m.setTrue(),k((e=>V(z({},e),{current:1}))),b((e=f.getFieldsValue(),Object.fromEntries(Object.entries(e).filter((([e,t])=>!v(t))))))}}),O(c,V(z({},l),{rowKey:n,sticky:a,loading:d.state,dataSource:y,pagination:V(z({},w),{showQuickJumper:!0}),onChange:(e,t,r,{action:n})=>{"filter"===n&&T(t),"sort"===n&&P(r),k(g(e,["current","pageSize","total"]))}}))]})}))};export{K as FormMode,B as useModalRef,D as useTableRef,N as withModal,I as withTable};//# sourceMappingURL=index.mjs.map